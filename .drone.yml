kind: pipeline
name: Pipeline

steps:
- name: build
  image: golang
  commands:
  - go get -v -t -d ./...
  - go build
  
- name: testing
  image: golang
  commands:
  - go get -v -t -d ./...
  - go test -v ./...

- name: publish
  image: plugins/docker
  settings:
    username:
      from_secret: DOCKER_USERNAME
    password:
      from_secret: DOCKER_PASSWORD
    repo: twogghub/go-droneci
    tags:
      - 1.0.2
      - latest
  when:
    branch:
    - master

- name: notify
  image: drillster/drone-email
    settings: 
      host: dockercomposejava_smtp_1
      username: user
      password: pwd
      port: 25
      from: drone@your-domain.com
      when:
        status: [ changed, failure ]

services:
- name: smtp
  image: catatnight/postfix
  ports:
    - "25:25"
  environment:
    - maildomain=emailboot.net
    - smtp_user=user:pwd
    - messageSizeLimit=40960000
    - mailboxSizeLimit=40960000

